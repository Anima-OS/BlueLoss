import { h } from 'hyperapp'
import _ from 'lodash'

import DeviceCard from '../components/deviceCard.lsc'

export default ({ actions, state }) ->
  infoWindowDisplay = if state.activeTab === 'statusTab': 'flex' else: 'none'
  statusAnimationVisibility = if state.blueLossEnabled: 'visible' else: 'hidden'
  blueLossStatusText = if state.blueLossEnabled: 'Enabled' else: 'Disabled'
  lookingForHeaderDisplay = if state.devicesToSearchFor.length > 0: 'block' else: 'none'

  <div id="statusTabInfoWindow" style={ { display: infoWindowDisplay } } >
    <div id="topStatus">
      <div id="statusAnimation" style={ { visibility: statusAnimationVisibility } }>
        <ul oncreate={ actions.animateDots }>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
        </ul>
      </div>
      <x-box id="disableButton">
        <x-switch
          id="bluelossenableswitch"
          toggled={ state.blueLossEnabled }
          onchange={(event):void ->
            actions.updateSetting({ settingName: 'blueLossEnabled', settingValue: event.currentTarget.toggled})
          }
        ></x-switch>
        <x-label for="bluelossenableswitch" id="bluelossenableswitch">Blueloss { blueLossStatusText }</x-label>
      </x-box>
    </div>
    <div id="devicesContainer">
      <div id="lookingForHeader" style={ { display: lookingForHeaderDisplay } } >
        Currently Looking For:
      </div>
      {
        state.devicesToSearchFor.map(({deviceName, deviceId}) ->
          <DeviceCard key={deviceId} actions={actions} lookingForDevice={true} deviceName={deviceName} deviceId={deviceId} />
        )
      }
      <div id="deviceAddHeader">
        Devices To Add:
      </div>
      {
        // Regular Array.includes compares by reference, not value, so using _.find.
        state.devicesCanSee
          .filter(({deviceId}) -> !_.find(state.devicesToSearchFor, {deviceId}))
          .map(({deviceName, deviceId}) ->
            <DeviceCard key={deviceId} actions={actions} lookingForDevice={false} deviceName={deviceName} deviceId={deviceId} />
          )
      }
    </div>
    <div id="devicesContainerBottomLip"></div>
  </div>
