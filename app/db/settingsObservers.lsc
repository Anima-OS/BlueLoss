
import gawk from 'gawk'

import { settingsWindow } from '../settingsWindow/settingsWindow.lsc'
import {
  addRollbarLogging,
  removeRollbarLogging,
  addUserDebugLogger,
  removeUserDebugLogger
} from '../common/logging/logging.lsc'
import { showDebugWindow, closeDebugWindow } from '../debugWindow/debugWindow.lsc'
import { changeTrayIcon } from '../tray/tray.lsc'

initSettingsObservers(settings):void ->
  gawk.watch(settings, ['lanLostEnabled'], (enabled: boolean):void ->
    settingsWindow?.webContents?.send('mainprocess:setting-updated-in-main', {lanLostEnabled: enabled})
  )
  gawk.watch(settings, ['reportErrors'], (enabled: boolean):void ->
    if enabled: addRollbarLogging()
    else: removeRollbarLogging()
  )
  gawk.watch(settings, ['userDebug'], (enabled: boolean):void ->
    if enabled:
      addUserDebugLogger()
      showDebugWindow()
    else:
      removeUserDebugLogger()
      closeDebugWindow()
  )
  gawk.watch(settings, ['trayIconColor'], changeTrayIcon)

export {
  initSettingsObservers
}
